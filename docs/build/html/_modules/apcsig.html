

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="es" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="es" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>apcsig &mdash; documentación de Geoprocesamiento en python y qgis - 1.0</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script type="text/javascript" src="../_static/translations.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Índice" href="../genindex.html" />
    <link rel="search" title="Búsqueda" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Geoprocesamiento en python y qgis
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Guias de uso:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../ejecucion.html">¿Cómo ejecutar un código en Qgis?</a></li>
</ul>
<p class="caption"><span class="caption-text">Códigos:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../apcsig.html">Libreria de funciones para el análsis espacial multicriterio</a></li>
<li class="toctree-l1"><a class="reference internal" href="../analisis.html">Análisis de sensibilidad</a></li>
<li class="toctree-l1"><a class="reference internal" href="../leesallee.html">Índice Lee-Sallee</a></li>
<li class="toctree-l1"><a class="reference internal" href="../owa.html">OWA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../verificacion.html">Verificación de capas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tabulacion_3geo.html">Tabular intersección entre 3 geometrías</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nivel_geometrias.html">Cobertura por niveles areas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usvmunicipal.html">Cobertura de uso y tipo de suelo a nivel municipal</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Geoprocesamiento en python y qgis</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Código de módulo</a> &raquo;</li>
        
      <li>apcsig</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Código fuente para apcsig</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Autor: Víctor Hernández D.</span>

<span class="sd">Correo: victor.hernandez@iecologia.unam.mx</span>

<span class="sd">user_github: @vichdzgeo</span>

<span class="sd">Colaboladores: LANCIS - UNAM</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">pprint</span>
<span class="kn">import</span> <span class="nn">string</span>
<span class="kn">import</span> <span class="nn">qgis</span> 
<span class="kn">import</span> <span class="nn">qgis.core</span>
<span class="kn">import</span> <span class="nn">numpy</span> 
<span class="kn">from</span> <span class="nn">osgeo</span> <span class="k">import</span> <span class="n">gdal</span>
<span class="kn">import</span> <span class="nn">gdal_calc</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">processing</span> <span class="k">as</span> <span class="nn">pr</span> 

<div class="viewcode-block" id="categorias_campo_csv"><a class="viewcode-back" href="../apcsig.html#apcsig.categorias_campo_csv">[documentos]</a><span class="k">def</span> <span class="nf">categorias_campo_csv</span><span class="p">(</span><span class="n">path_shape</span><span class="p">,</span><span class="n">campo</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Esta función extrae las categorias únicas de un campo dado de una capa vectorial, el </span>
<span class="sd">    archivo csv se guarda en la misma ruta de la capa vectorial y es nombrado como : **categorias_campo_nombre_capa.csv**</span>

<span class="sd">    .. note:: </span>

<span class="sd">        En dado caso que el nombre de la categoria contenga el símbolo de &#39;,&#39; está función la remplaza por &#39;;&#39; para evitar errores en la escritura del archivo csv</span>
<span class="sd">    </span>
<span class="sd">    :param path_shape: ruta de la capa vectorial </span>
<span class="sd">    :type path_shape: str</span>

<span class="sd">    :param campo: nombre del campo que contiene las categorias</span>
<span class="sd">    :type campo: str</span>


<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">layer</span> <span class="o">=</span> <span class="n">QgsVectorLayer</span><span class="p">(</span><span class="n">path_shape</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;ogr&quot;</span><span class="p">)</span>
    <span class="n">nombre_capa</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">source</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">path_categorias</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">layer</span><span class="o">.</span><span class="n">source</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="s2">&quot;/categorias_&quot;</span><span class="o">+</span><span class="n">campo</span><span class="o">+</span><span class="s2">&quot;_&quot;</span><span class="o">+</span><span class="n">nombre_capa</span><span class="o">+</span><span class="s2">&quot;.csv&quot;</span>
    <span class="n">archivo</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">path_categorias</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">consulta</span> <span class="o">=</span> <span class="n">QgsFeatureRequest</span><span class="p">()</span><span class="o">.</span><span class="n">setFlags</span><span class="p">(</span><span class="n">QgsFeatureRequest</span><span class="o">.</span><span class="n">NoGeometry</span><span class="p">)</span>
    <span class="n">lista</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="n">campo</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">layer</span><span class="o">.</span><span class="n">getFeatures</span><span class="p">(</span><span class="n">consulta</span><span class="p">)]))</span>
    <span class="n">lista</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="nb">print</span> <span class="p">(</span><span class="n">lista</span><span class="p">)</span>
    <span class="n">archivo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;id,categoria</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lista</span><span class="p">)):</span>
        <span class="n">archivo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="n">lista</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">,</span><span class="s1">&#39;;&#39;</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">archivo</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;archivo csv de categorias creado...&#39;</span><span class="p">)</span>
    <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;ruta: &#39;</span><span class="p">,</span><span class="n">path_categorias</span><span class="p">)</span></div>
<div class="viewcode-block" id="campos_minusculas"><a class="viewcode-back" href="../apcsig.html#apcsig.campos_minusculas">[documentos]</a><span class="k">def</span> <span class="nf">campos_minusculas</span><span class="p">(</span><span class="n">path_shape</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Esta función renombra los campos en minúsculas</span>

<span class="sd">    :param path_shape: Ruta de la capa vectorial</span>
<span class="sd">    :type path_shape: str</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">layer</span> <span class="o">=</span> <span class="n">QgsVectorLayer</span><span class="p">(</span><span class="n">path_shape</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;ogr&quot;</span><span class="p">)</span>
    <span class="n">campos</span> <span class="o">=</span> <span class="p">[</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">()</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">layer</span><span class="o">.</span><span class="n">fields</span><span class="p">()]</span>
    <span class="k">for</span> <span class="n">campo</span> <span class="ow">in</span> <span class="n">campos</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">layer</span><span class="o">.</span><span class="n">pendingFields</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">campo</span> <span class="o">==</span> <span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">():</span>
                <span class="k">with</span> <span class="n">edit</span><span class="p">(</span><span class="n">layer</span><span class="p">):</span>
                    <span class="n">idx</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">fieldNameIndex</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">())</span>
                    <span class="n">layer</span><span class="o">.</span><span class="n">renameAttribute</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
    <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Proceso terminado&quot;</span><span class="p">)</span></div>
<div class="viewcode-block" id="campos_mayusculas"><a class="viewcode-back" href="../apcsig.html#apcsig.campos_mayusculas">[documentos]</a><span class="k">def</span> <span class="nf">campos_mayusculas</span><span class="p">(</span><span class="n">path_shape</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Esta función renombra los campos en mayusculas</span>

<span class="sd">    :param path_shape: Ruta de la capa vectorial</span>
<span class="sd">    :type path_shape: str</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">layer</span> <span class="o">=</span> <span class="n">QgsVectorLayer</span><span class="p">(</span><span class="n">path_shape</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;ogr&quot;</span><span class="p">)</span>
    <span class="n">campos</span> <span class="o">=</span> <span class="p">[</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">()</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">layer</span><span class="o">.</span><span class="n">fields</span><span class="p">()]</span>
    <span class="k">for</span> <span class="n">campo</span> <span class="ow">in</span> <span class="n">campos</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">layer</span><span class="o">.</span><span class="n">pendingFields</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">campo</span> <span class="o">==</span> <span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">():</span>
                <span class="k">with</span> <span class="n">edit</span><span class="p">(</span><span class="n">layer</span><span class="p">):</span>
                    <span class="n">idx</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">fieldNameIndex</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">())</span>
                    <span class="n">layer</span><span class="o">.</span><span class="n">renameAttribute</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
    <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Proceso terminado&quot;</span><span class="p">)</span></div>
<div class="viewcode-block" id="vcopia"><a class="viewcode-back" href="../apcsig.html#apcsig.vcopia">[documentos]</a><span class="k">def</span> <span class="nf">vcopia</span><span class="p">(</span><span class="n">path_vector</span><span class="p">,</span> <span class="n">path_salida</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Crea una copia de la capa a partir de la ruta de la capa,</span>
<span class="sd">    la capa es creada con el mismo sistema de referencia que el origen.</span>

<span class="sd">    :param path_vector: ruta de la capa original</span>
<span class="sd">    :type path_vector: String</span>

<span class="sd">    :param path_salida: ruta de donde sera almacenada la capa</span>
<span class="sd">    :type path_salida: String</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">vlayer</span> <span class="o">=</span> <span class="n">QgsVectorLayer</span><span class="p">(</span><span class="n">path_vector</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;ogr&quot;</span><span class="p">)</span>
    <span class="n">clonarv</span> <span class="o">=</span> <span class="n">QgsVectorFileWriter</span><span class="o">.</span><span class="n">writeAsVectorFormat</span><span class="p">(</span><span class="n">vlayer</span><span class="p">,</span>
                                                      <span class="n">path_salida</span><span class="p">,</span>
                                                      <span class="s1">&#39;utf-8&#39;</span><span class="p">,</span>
                                                      <span class="n">vlayer</span><span class="o">.</span><span class="n">crs</span><span class="p">(),</span>
                                                      <span class="s2">&quot;ESRI Shapefile&quot;</span><span class="p">)</span></div>
<div class="viewcode-block" id="llenar_campos_nulos"><a class="viewcode-back" href="../apcsig.html#apcsig.llenar_campos_nulos">[documentos]</a><span class="k">def</span> <span class="nf">llenar_campos_nulos</span><span class="p">(</span><span class="n">path_vector</span><span class="p">,</span><span class="n">valor</span><span class="o">=-</span><span class="mi">9999</span><span class="p">):</span>

    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    :param path_vector: Ruta de la capa vectorial</span>
<span class="sd">    :type path_vector: str</span>

<span class="sd">    :param valor: valor numérico para rellenar los campos vacios por default se establece -9999</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">layer</span><span class="o">=</span><span class="n">QgsVectorLayer</span><span class="p">(</span><span class="n">path_vector</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;ogr&quot;</span><span class="p">)</span>
    <span class="n">lista</span> <span class="o">=</span> <span class="p">[</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">()</span>  <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">layer</span><span class="o">.</span><span class="n">fields</span><span class="p">()</span> <span class="k">if</span>  <span class="n">field</span><span class="o">.</span><span class="n">typeName</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;String&#39;</span> <span class="ow">and</span> <span class="n">field</span><span class="o">.</span><span class="n">typeName</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;Date&#39;</span><span class="p">]</span>
    <span class="n">layer</span><span class="o">.</span><span class="n">startEditing</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">poligono</span> <span class="ow">in</span> <span class="n">layer</span><span class="o">.</span><span class="n">getFeatures</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">campo</span> <span class="ow">in</span> <span class="n">lista</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">poligono</span><span class="p">[</span><span class="n">campo</span><span class="p">]:</span>
               <span class="n">poligono</span><span class="p">[</span><span class="n">campo</span><span class="p">]</span> <span class="o">=</span> <span class="n">valor</span>
        <span class="n">layer</span><span class="o">.</span><span class="n">updateFeature</span><span class="p">(</span><span class="n">poligono</span><span class="p">)</span>
    <span class="n">layer</span><span class="o">.</span><span class="n">commitChanges</span><span class="p">()</span></div>
<div class="viewcode-block" id="capa_binaria"><a class="viewcode-back" href="../apcsig.html#apcsig.capa_binaria">[documentos]</a><span class="k">def</span> <span class="nf">capa_binaria</span><span class="p">(</span><span class="n">path_v</span><span class="p">,</span><span class="n">campo_cat</span><span class="o">=</span><span class="s1">&#39;presencia&#39;</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Esta función crea un campo llamado presencia y asigna </span>
<span class="sd">    a cada elemento el valor de 1 </span>
<span class="sd">    </span>
<span class="sd">    :param path_v: ruta de la capa vectorial</span>
<span class="sd">    :type path_v: str</span>


<span class="sd">    :param campo_cat: nombre del campo a crear, por default es presencia</span>
<span class="sd">    :type campo_cat: str</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">vlayer</span> <span class="o">=</span> <span class="n">QgsVectorLayer</span><span class="p">(</span><span class="n">path_v</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;ogr&quot;</span><span class="p">)</span>
    <span class="n">campos</span> <span class="o">=</span> <span class="p">[</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">()</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">vlayer</span><span class="o">.</span><span class="n">fields</span><span class="p">()]</span>
    <span class="k">if</span> <span class="n">campo_cat</span> <span class="ow">in</span> <span class="n">campos</span><span class="p">:</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;el campo ya existe, se actualiza el contenido&#39;</span><span class="p">)</span>
        <span class="n">vlayer</span><span class="o">.</span><span class="n">startEditing</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">vlayer</span><span class="o">.</span><span class="n">getFeatures</span><span class="p">():</span>
            <span class="n">l</span><span class="p">[</span><span class="n">campo_cat</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span>
            <span class="n">vlayer</span><span class="o">.</span><span class="n">updateFeature</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
        <span class="n">vlayer</span><span class="o">.</span><span class="n">commitChanges</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">vlayer</span><span class="o">.</span><span class="n">dataProvider</span><span class="p">()</span><span class="o">.</span><span class="n">addAttributes</span><span class="p">([</span><span class="n">QgsField</span><span class="p">(</span><span class="n">campo_cat</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span><span class="n">QVariant</span><span class="o">.</span><span class="n">Int</span><span class="p">)])</span>
        <span class="n">vlayer</span><span class="o">.</span><span class="n">updateFields</span><span class="p">()</span>
        <span class="n">vlayer</span><span class="o">.</span><span class="n">startEditing</span><span class="p">()</span>
        <span class="n">vlayer</span><span class="o">.</span><span class="n">commitChanges</span><span class="p">()</span>
        <span class="n">vlayer</span><span class="o">.</span><span class="n">startEditing</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">vlayer</span><span class="o">.</span><span class="n">getFeatures</span><span class="p">():</span>
            <span class="n">l</span><span class="p">[</span><span class="n">campo_cat</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span>
            <span class="n">vlayer</span><span class="o">.</span><span class="n">updateFeature</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
        <span class="n">vlayer</span><span class="o">.</span><span class="n">commitChanges</span><span class="p">()</span>
    <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;capa clasificada...&#39;</span><span class="p">)</span></div>
<div class="viewcode-block" id="agregar_categorias"><a class="viewcode-back" href="../apcsig.html#apcsig.agregar_categorias">[documentos]</a><span class="k">def</span> <span class="nf">agregar_categorias</span><span class="p">(</span><span class="n">path_v</span><span class="p">,</span><span class="n">campo</span><span class="p">,</span><span class="n">nuevo_int_cats</span><span class="o">=</span><span class="s1">&#39;categorias&#39;</span><span class="p">,</span><span class="n">cont</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Esta función reclasifica una capa en enteros consecutivos en función de las categorias únicas de un </span>
<span class="sd">    campo en especificico, como subproducto genera un archivo csv con las categorias.</span>

<span class="sd">    :param path_v: ruta de capa vectorial</span>
<span class="sd">    :type path_v: str</span>

<span class="sd">    :param campo: nombre del campo que contiene las categorias</span>
<span class="sd">    :type campo: str</span>

<span class="sd">    :param nuevo_int_cats: nombre del campo a crear, el cúal contendrá las categorias en enteros</span>
<span class="sd">    :type nuevo_int_cats: str</span>
<span class="sd">    </span>
<span class="sd">    :param cont: contador para empezar la numeración en el número indicado, por defecto es 1</span>
<span class="sd">    :type cont: int</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">vlayer</span> <span class="o">=</span> <span class="n">QgsVectorLayer</span><span class="p">(</span><span class="n">path_v</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;ogr&quot;</span><span class="p">)</span>
    <span class="n">campos</span> <span class="o">=</span> <span class="p">[</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">()</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">vlayer</span><span class="o">.</span><span class="n">fields</span><span class="p">()]</span>
    <span class="n">lista</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">i</span><span class="p">[</span><span class="n">campo</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">vlayer</span><span class="o">.</span><span class="n">getFeatures</span><span class="p">()]))</span>
    <span class="n">lista</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span> <span class="c1"># Ordena las categorias alfabeticamente </span>
    <span class="k">if</span> <span class="n">nuevo_int_cats</span> <span class="ow">in</span> <span class="n">campos</span><span class="p">:</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;el campo ya existe, se actualiza el contenido&#39;</span><span class="p">)</span>
        <span class="n">vlayer</span><span class="o">.</span><span class="n">startEditing</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">cat</span> <span class="ow">in</span> <span class="n">lista</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">vlayer</span><span class="o">.</span><span class="n">getFeatures</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">cat</span> <span class="o">==</span> <span class="n">l</span><span class="p">[</span><span class="n">campo</span><span class="p">]:</span>
                    <span class="n">l</span><span class="p">[</span><span class="n">nuevo_int_cats</span><span class="p">]</span><span class="o">=</span><span class="n">cont</span>
                    <span class="n">vlayer</span><span class="o">.</span><span class="n">updateFeature</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
            <span class="n">cont</span> <span class="o">+=</span><span class="mi">1</span>
        <span class="n">vlayer</span><span class="o">.</span><span class="n">commitChanges</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">vlayer</span><span class="o">.</span><span class="n">dataProvider</span><span class="p">()</span><span class="o">.</span><span class="n">addAttributes</span><span class="p">([</span><span class="n">QgsField</span><span class="p">(</span><span class="n">nuevo_int_cats</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span><span class="n">QVariant</span><span class="o">.</span><span class="n">Int</span><span class="p">)])</span>
        <span class="n">vlayer</span><span class="o">.</span><span class="n">updateFields</span><span class="p">()</span>
        <span class="n">vlayer</span><span class="o">.</span><span class="n">startEditing</span><span class="p">()</span>
        <span class="n">vlayer</span><span class="o">.</span><span class="n">commitChanges</span><span class="p">()</span>
        <span class="n">vlayer</span><span class="o">.</span><span class="n">startEditing</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">cat</span> <span class="ow">in</span> <span class="n">lista</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">vlayer</span><span class="o">.</span><span class="n">getFeatures</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">cat</span> <span class="o">==</span> <span class="n">l</span><span class="p">[</span><span class="n">campo</span><span class="p">]:</span>
                    <span class="n">l</span><span class="p">[</span><span class="n">nuevo_int_cats</span><span class="p">]</span><span class="o">=</span><span class="n">cont</span>
                    <span class="n">vlayer</span><span class="o">.</span><span class="n">updateFeature</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
            <span class="n">cont</span> <span class="o">+=</span><span class="mi">1</span>
        <span class="n">vlayer</span><span class="o">.</span><span class="n">commitChanges</span><span class="p">()</span>
    <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;capa clasificada...&#39;</span><span class="p">)</span>
    <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;generando archivo txt de categorias...&#39;</span><span class="p">)</span>
    <span class="n">path_tp_reglas</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_v</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="s2">&quot;/reglas_&quot;</span><span class="o">+</span><span class="n">path_v</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;.txt&quot;</span>
    <span class="n">reglas</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">path_tp_reglas</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">cont</span><span class="p">):</span>
        <span class="n">reglas</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; = &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="n">lista</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">reglas</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>
<div class="viewcode-block" id="rasterizar_vector"><a class="viewcode-back" href="../apcsig.html#apcsig.rasterizar_vector">[documentos]</a><span class="k">def</span> <span class="nf">rasterizar_vector</span> <span class="p">(</span><span class="n">path_vector</span><span class="p">,</span><span class="n">n_campo</span><span class="p">,</span><span class="n">region</span><span class="p">,</span><span class="n">path_salida</span><span class="p">,</span><span class="n">tipo</span><span class="o">=</span><span class="s1">&#39;int&#39;</span><span class="p">,</span><span class="n">ancho</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">alto</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Esta función rasteriza una capa vectorial a partir de un campo de tipo numérico y dada una región </span>
<span class="sd">    y el numero de columnas (ancho) y el numero de renglones (alto)</span>

<span class="sd">    :param path_vector: ruta de la capa vectorial</span>
<span class="sd">    :type path_vector: str</span>

<span class="sd">    :param n_campo: nombre del campo que contiene los id de las categorias </span>
<span class="sd">    :type  n_campo: srt</span>

<span class="sd">    :param region: coordenadas de la región del estudio  xmin,xmax,ymin,ymax</span>
<span class="sd">    :type region: str</span>

<span class="sd">    :param path_salida: ruta de la capa de salida con extension tif</span>
<span class="sd">    :type path_salida: str</span>

<span class="sd">    :param tipo: tipo de dato, use &#39;int&#39; para entero o &#39;float&#39; para flotante, por default es entero</span>
<span class="sd">    :type tipo: str</span>

<span class="sd">    </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">vector</span> <span class="o">=</span> <span class="n">QgsVectorLayer</span><span class="p">(</span><span class="n">path_vector</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;ogr&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">tipo</span> <span class="o">==</span> <span class="s1">&#39;int&#39;</span><span class="p">:</span>
        <span class="n">v_tipo</span> <span class="o">=</span> <span class="mi">4</span> <span class="c1"># valor para especificar entero a 32 bits</span>
    <span class="k">elif</span> <span class="n">tipo</span> <span class="o">==</span> <span class="s1">&#39;float&#39;</span><span class="p">:</span>
        <span class="n">v_tipo</span> <span class="o">=</span><span class="mi">5</span> <span class="c1"># valor para flotante </span>

    <span class="n">dicc</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;INPUT&#39;</span><span class="p">:</span><span class="n">vector</span><span class="p">,</span>
        <span class="s1">&#39;FIELD&#39;</span><span class="p">:</span><span class="n">n_campo</span><span class="p">,</span>
        <span class="s1">&#39;BURN&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
        <span class="s1">&#39;UNITS&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
        <span class="s1">&#39;WIDTH&#39;</span><span class="p">:</span><span class="n">ancho</span><span class="p">,</span> 
        <span class="s1">&#39;HEIGHT&#39;</span><span class="p">:</span><span class="n">alto</span><span class="p">,</span>
        <span class="s1">&#39;EXTENT&#39;</span><span class="p">:</span><span class="n">region</span><span class="p">,</span>
        <span class="s1">&#39;NODATA&#39;</span><span class="p">:</span><span class="o">-</span><span class="mf">9999.0</span><span class="p">,</span>
        <span class="s1">&#39;OPTIONS&#39;</span><span class="p">:</span><span class="s1">&#39;COMPRESS=LZW&#39;</span><span class="p">,</span>
        <span class="s1">&#39;DATA_TYPE&#39;</span><span class="p">:</span><span class="n">v_tipo</span><span class="p">,</span>
        <span class="s1">&#39;INIT&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span>
        <span class="s1">&#39;INVERT&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span>
        <span class="s1">&#39;OUTPUT&#39;</span><span class="p">:</span><span class="n">path_salida</span><span class="p">}</span>
    <span class="n">pr</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;gdal:rasterize&quot;</span><span class="p">,</span> <span class="n">dicc</span><span class="p">)</span></div>


<span class="c1">######## FUNCIONES A DATOS RASTER ###########</span>

<div class="viewcode-block" id="alinear_raster"><a class="viewcode-back" href="../apcsig.html#apcsig.alinear_raster">[documentos]</a><span class="k">def</span> <span class="nf">alinear_raster</span><span class="p">(</span><span class="n">path_raster</span><span class="p">,</span><span class="n">region</span><span class="p">,</span><span class="n">resolucion</span><span class="p">,</span><span class="n">path_salida</span><span class="p">,</span><span class="n">crs_destino</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">tipo</span><span class="o">=</span><span class="s1">&#39;int&#39;</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Esta función alinea un raster dada una región y el tamaño de pixel </span>
<span class="sd">    :param path_raster: ruta de la capa a alinear</span>
<span class="sd">    :type path_raster: str</span>

<span class="sd">    :param region: coordenadas de la región del estudio  xmin,xmax,ymin,ymax</span>
<span class="sd">    :type region: str </span>

<span class="sd">    :param resolucion: tamaño de pixel</span>
<span class="sd">    :type resolucion: int </span>

<span class="sd">    :param path_salida: ruta de la capa de salida con extension tif</span>
<span class="sd">    :type path_salida: str</span>

<span class="sd">    :param crs_destino: nombre del código EPSG,</span>
<span class="sd">    :type crs_destino:  str </span>

<span class="sd">    :param tipo: tipo de dato, use &#39;int&#39; para entero o &#39;float&#39; para flotante, por default es entero</span>
<span class="sd">    :type tipo: str</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">tipo</span> <span class="o">==</span> <span class="s1">&#39;int&#39;</span><span class="p">:</span>
        <span class="n">v_tipo</span> <span class="o">=</span> <span class="mi">5</span> <span class="c1"># valor para especificar entero a 32bits</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">v_tipo</span> <span class="o">=</span><span class="mi">6</span> <span class="c1"># valor para flotante </span>
    <span class="k">if</span> <span class="n">crs_destino</span> <span class="o">==</span><span class="s1">&#39;&#39;</span><span class="p">:</span>
        <span class="n">crs_destino</span> <span class="o">=</span> <span class="n">extrae_crs</span><span class="p">(</span><span class="n">path_raster</span><span class="p">)</span>

    <span class="n">dicc</span> <span class="o">=</span>  <span class="p">{</span><span class="s1">&#39;INPUT&#39;</span><span class="p">:</span><span class="n">path_raster</span><span class="p">,</span>
        <span class="s1">&#39;SOURCE_CRS&#39;</span><span class="p">:</span><span class="n">extrae_crs</span><span class="p">(</span><span class="n">path_raster</span><span class="p">),</span>
        <span class="s1">&#39;TARGET_CRS&#39;</span><span class="p">:</span><span class="n">crs_destino</span><span class="p">,</span>
        <span class="s1">&#39;RESAMPLING&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
        <span class="s1">&#39;NODATA&#39;</span><span class="p">:</span><span class="o">-</span><span class="mi">9999</span><span class="p">,</span>
        <span class="s1">&#39;TARGET_RESOLUTION&#39;</span><span class="p">:</span><span class="n">resolucion</span><span class="p">,</span>
        <span class="s1">&#39;OPTIONS&#39;</span><span class="p">:</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
        <span class="s1">&#39;DATA_TYPE&#39;</span><span class="p">:</span><span class="n">v_tipo</span><span class="p">,</span>
        <span class="s1">&#39;TARGET_EXTENT&#39;</span><span class="p">:</span><span class="n">region</span><span class="p">,</span>
        <span class="s1">&#39;TARGET_EXTENT_CRS&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span>
        <span class="s1">&#39;MULTITHREADING&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span>
        <span class="s1">&#39;EXTRA&#39;</span><span class="p">:</span><span class="s1">&#39;--co=&quot;COMPRESS=LZW&quot;&#39;</span><span class="p">,</span>
        <span class="s1">&#39;OUTPUT&#39;</span><span class="p">:</span><span class="n">path_salida</span><span class="p">}</span>
    <span class="n">pr</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;gdal:warpreproject&quot;</span><span class="p">,</span><span class="n">dicc</span><span class="p">)</span></div>
<div class="viewcode-block" id="aplica_mascara"><a class="viewcode-back" href="../apcsig.html#apcsig.aplica_mascara">[documentos]</a><span class="k">def</span> <span class="nf">aplica_mascara</span><span class="p">(</span><span class="n">path_mascara</span><span class="p">,</span> <span class="n">path_capa</span><span class="p">,</span> <span class="n">path_salida</span><span class="p">,</span> <span class="n">region</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Esta función aplica la máscara de la zona de estudio a una capa raster, </span>
<span class="sd">    es importante que la capa a la cual se aplicará la máscara este previamente alineada</span>

<span class="sd">    :param path_mascara: ruta de la mascara en formato tiff</span>
<span class="sd">    :type path_mascara: str</span>


<span class="sd">    :param path_capa: ruta de la capa a la cual se requiere aplicar la máscara</span>
<span class="sd">    :type path_capa: str</span>

<span class="sd">    :param path_salida: ruta de la capa resultado de aplicar la máscara</span>
<span class="sd">    :type path_salida: str</span>

<span class="sd">    :param region: coordenadas de la región del estudio  xmin,xmax,ymin,ymax</span>
<span class="sd">    :type region: str</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">dicc</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span><span class="n">path_mascara</span><span class="p">,</span>
    <span class="s1">&#39;b&#39;</span><span class="p">:</span><span class="n">path_capa</span><span class="p">,</span>
    <span class="s1">&#39;c&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span>
    <span class="s1">&#39;d&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span>
    <span class="s1">&#39;e&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span>
    <span class="s1">&#39;f&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span>
    <span class="s1">&#39;expression&#39;</span><span class="p">:</span><span class="s1">&#39;A*B&#39;</span><span class="p">,</span>
    <span class="s1">&#39;output&#39;</span><span class="p">:</span><span class="n">path_salida</span><span class="p">,</span>
    <span class="s1">&#39;GRASS_REGION_PARAMETER&#39;</span><span class="p">:</span><span class="n">region</span><span class="p">,</span>
    <span class="s1">&#39;GRASS_REGION_CELLSIZE_PARAMETER&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
    <span class="s1">&#39;GRASS_RASTER_FORMAT_OPT&#39;</span><span class="p">:</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="s1">&#39;GRASS_RASTER_FORMAT_META&#39;</span><span class="p">:</span><span class="s1">&#39;&#39;</span><span class="p">}</span>
    <span class="n">pr</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;grass7:r.mapcalc.simple&quot;</span><span class="p">,</span> <span class="n">dicc</span><span class="p">)</span></div>
<div class="viewcode-block" id="get_region"><a class="viewcode-back" href="../apcsig.html#apcsig.get_region">[documentos]</a><span class="k">def</span> <span class="nf">get_region</span><span class="p">(</span><span class="n">path_layer</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Esta función extrae la región o extensión de una capa raster así como el número de columnas y renglones</span>

<span class="sd">    :param path_layer: ruta de la capa raster</span>
<span class="sd">    :type path_layer: str</span>

<span class="sd">    :returns: en forma de lista [1,2,3] [1] las coordenadas de la extensión de una capa raster xmin,xmax,ymin,ymax ; [2]. ancho de una capa raster (número de columnas) y [3]. alto de una capa raster (número de renglones)</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">layer</span> <span class="o">=</span> <span class="n">QgsRasterLayer</span><span class="p">(</span><span class="n">path_layer</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">ext</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">extent</span><span class="p">()</span>
    <span class="n">xmin</span> <span class="o">=</span> <span class="n">ext</span><span class="o">.</span><span class="n">xMinimum</span><span class="p">()</span>
    <span class="n">xmax</span> <span class="o">=</span> <span class="n">ext</span><span class="o">.</span><span class="n">xMaximum</span><span class="p">()</span>
    <span class="n">ymin</span> <span class="o">=</span> <span class="n">ext</span><span class="o">.</span><span class="n">yMinimum</span><span class="p">()</span>
    <span class="n">ymax</span> <span class="o">=</span> <span class="n">ext</span><span class="o">.</span><span class="n">yMaximum</span><span class="p">()</span>

    <span class="n">region</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%f</span><span class="s2">,</span><span class="si">%f</span><span class="s2">,</span><span class="si">%f</span><span class="s2">,</span><span class="si">%f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">)</span>
    <span class="n">ancho</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">width</span><span class="p">()</span>
    <span class="n">alto</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">height</span><span class="p">()</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">region</span><span class="p">,</span><span class="n">ancho</span><span class="p">,</span><span class="n">alto</span><span class="p">]</span></div>
<div class="viewcode-block" id="ecuacion_clp"><a class="viewcode-back" href="../apcsig.html#apcsig.ecuacion_clp">[documentos]</a><span class="k">def</span> <span class="nf">ecuacion_clp</span><span class="p">(</span><span class="n">pesos</span><span class="p">):</span>

    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Esta función recibe una lista de pesos para regresar la ecuación</span>
<span class="sd">    en la estructura requerida por gdal para la combinación lineal ponderada. </span>
<span class="sd">    </span>
<span class="sd">    **ejemplo:**</span>

<span class="sd">    .. math::</span>

<span class="sd">        ecuacion = A*0.40 + B*0.25 + C*0.15 +D*0.20</span>

<span class="sd">    :param pesos: lista de los pesos de las capas, salida de la función </span>
<span class="sd">    :type pesos: lista</span>

<span class="sd">    :returns: ecuación en formato gdal para ser ingresada a la funcion crea_capa_raster</span>
<span class="sd">    :type returns: str</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">n_variables</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">pesos</span><span class="p">)</span>
    <span class="n">abc</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">ascii_uppercase</span><span class="p">)</span>
    <span class="n">ecuacion</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">for</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n_variables</span><span class="p">),</span><span class="n">pesos</span><span class="p">):</span>
        
        <span class="k">if</span> <span class="n">a</span> <span class="o">&lt;</span> <span class="n">n_variables</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">ecuacion</span><span class="o">+=</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39; * &#39;</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">abc</span><span class="p">[</span><span class="n">a</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39; + &#39;</span> <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ecuacion</span><span class="o">+=</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39; * &#39;</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">abc</span><span class="p">[</span><span class="n">a</span><span class="p">]))</span>
    <span class="k">return</span> <span class="n">ecuacion</span></div>
<div class="viewcode-block" id="normailiza"><a class="viewcode-back" href="../apcsig.html#apcsig.normailiza">[documentos]</a><span class="k">def</span> <span class="nf">normailiza</span><span class="p">(</span><span class="n">path_raster</span><span class="p">,</span> <span class="n">path_raster_n</span><span class="p">,</span><span class="n">modo</span><span class="o">=</span><span class="s1">&#39;ideales&#39;</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Esta función normaliza una capa raster, se puede elegir entre dos tipos de normalización.</span>

<span class="sd">    1) ideales: La capa ráster se divide entre el valor máximo como resultado se tiene una capa con un máximo de 1 pero el valor mínimo no necesariamente será 0</span>

<span class="sd">    .. math:: </span>

<span class="sd">        ideales=\\frac{A}{A.max}</span>
<span class="sd">    </span>
<span class="sd">    2) lineal: la capa ráster resultante tendra como valor máximo 1 y como valor mínimo 0</span>
<span class="sd">    el 1 representará el maximo de la capa de entrada y el 0 representa el valor mínimo de la </span>
<span class="sd">    capa de entrada</span>

<span class="sd">    .. math::</span>

<span class="sd">        lineal=\\frac{A -A.min}{A.max - A.min}</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="nb">min</span><span class="p">,</span><span class="nb">max</span> <span class="o">=</span> <span class="n">raster_min_max</span><span class="p">(</span><span class="n">path_raster</span><span class="p">)</span>
    
    <span class="n">no_data</span> <span class="o">=</span><span class="n">raster_nodata</span><span class="p">(</span><span class="n">path_raster</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">modo</span> <span class="o">==</span> <span class="s1">&#39;ideales&#39;</span><span class="p">:</span>
        <span class="n">ec_norm</span> <span class="o">=</span><span class="s1">&#39;(A&#39;</span> <span class="o">+</span> <span class="s1">&#39;) / (&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">max</span><span class="p">)</span> <span class="o">+</span><span class="s1">&#39;)&#39;</span>  <span class="c1"># llevar a ideal </span>
    <span class="k">elif</span> <span class="n">modo</span> <span class="o">==</span> <span class="s1">&#39;lineal&#39;</span><span class="p">:</span>
        <span class="n">ec_norm</span> <span class="o">=</span><span class="s1">&#39;(A - &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">min</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;) / (&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">max</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">min</span><span class="p">)</span> <span class="o">+</span><span class="s1">&#39;)&#39;</span>  <span class="c1"># normalizar </span>
    <span class="n">dicc</span> <span class="o">=</span><span class="p">{</span>        
        <span class="s1">&#39;INPUT_A&#39;</span><span class="p">:</span><span class="n">path_raster</span><span class="p">,</span>
        <span class="s1">&#39;BAND_A&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
        <span class="s1">&#39;FORMULA&#39;</span><span class="p">:</span><span class="n">ec_norm</span><span class="p">,</span>
        <span class="s1">&#39;NO_DATA&#39;</span><span class="p">:</span> <span class="n">no_data</span><span class="p">,</span>
        <span class="s1">&#39;RTYPE&#39;</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span>
        <span class="s1">&#39;EXTRA&#39;</span><span class="p">:</span><span class="s1">&#39;--co=&quot;COMPRESS=LZW&quot;&#39;</span><span class="p">,</span>
        <span class="s1">&#39;OUTPUT&#39;</span><span class="p">:</span><span class="n">path_raster_n</span><span class="p">}</span>
    <span class="n">pr</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;gdal:rastercalculator&quot;</span><span class="p">,</span><span class="n">dicc</span><span class="p">)</span></div>

<div class="viewcode-block" id="raster_min_max"><a class="viewcode-back" href="../apcsig.html#apcsig.raster_min_max">[documentos]</a><span class="k">def</span> <span class="nf">raster_min_max</span><span class="p">(</span><span class="n">path_raster</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Esta funcion regresa los valores maximos y minimos de una capa raster</span>

<span class="sd">    :param path_raster: ruta de la capa raster</span>
<span class="sd">    :type path_raster: str </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">rlayer</span> <span class="o">=</span> <span class="n">QgsRasterLayer</span><span class="p">(</span><span class="n">path_raster</span><span class="p">,</span><span class="s2">&quot;raster&quot;</span><span class="p">)</span>
    <span class="n">extent</span> <span class="o">=</span> <span class="n">rlayer</span><span class="o">.</span><span class="n">extent</span><span class="p">()</span>
    <span class="n">provider</span> <span class="o">=</span> <span class="n">rlayer</span><span class="o">.</span><span class="n">dataProvider</span><span class="p">()</span>
    <span class="n">stats</span> <span class="o">=</span> <span class="n">provider</span><span class="o">.</span><span class="n">bandStatistics</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span>
                                    <span class="n">QgsRasterBandStats</span><span class="o">.</span><span class="n">All</span><span class="p">,</span>
                                    <span class="n">extent</span><span class="p">,</span>
                                    <span class="mi">0</span><span class="p">)</span>

    <span class="n">v_min</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">minimumValue</span>
    <span class="n">v_max</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">maximumValue</span>
    <span class="k">return</span> <span class="n">v_min</span><span class="p">,</span> <span class="n">v_max</span></div>
<div class="viewcode-block" id="redondea_raster"><a class="viewcode-back" href="../apcsig.html#apcsig.redondea_raster">[documentos]</a><span class="k">def</span> <span class="nf">redondea_raster</span><span class="p">(</span><span class="n">path_raster</span><span class="p">,</span><span class="n">salida</span><span class="p">,</span><span class="n">no_decimales</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Esta función redondea una capa raster de tipo flotante en el número de decimales indicado</span>

<span class="sd">    :param path_raster: ruta de la capa raster</span>
<span class="sd">    :type path_raster: str</span>

<span class="sd">    :param no_decimales: número de decimales a los que se va a redondear la capa, por default es 3</span>
<span class="sd">    :type no_decimaes: int</span>

<span class="sd">    :param salida: ruta de la capa de salida</span>
<span class="sd">    :type salida: str</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">dicc</span> <span class="o">=</span>  <span class="p">{</span><span class="s1">&#39;INPUT_A&#39;</span><span class="p">:</span><span class="n">path_raster</span><span class="p">,</span>
                <span class="s1">&#39;BAND_A&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
                <span class="s1">&#39;INPUT_B&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span>
                <span class="s1">&#39;BAND_B&#39;</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                <span class="s1">&#39;INPUT_C&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span>
                <span class="s1">&#39;BAND_C&#39;</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                <span class="s1">&#39;INPUT_D&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span>
                <span class="s1">&#39;BAND_D&#39;</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                <span class="s1">&#39;INPUT_E&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span>
                <span class="s1">&#39;BAND_E&#39;</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                <span class="s1">&#39;INPUT_F&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span>
                <span class="s1">&#39;BAND_F&#39;</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                <span class="s1">&#39;FORMULA&#39;</span><span class="p">:</span><span class="s1">&#39;A.round(&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">no_decimales</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;)&#39;</span><span class="p">,</span>
                <span class="s1">&#39;NO_DATA&#39;</span><span class="p">:</span><span class="o">-</span><span class="mf">9999.0</span><span class="p">,</span>
                <span class="s1">&#39;RTYPE&#39;</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span>
                <span class="s1">&#39;OPTIONS&#39;</span><span class="p">:</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                <span class="s1">&#39;EXTRA&#39;</span><span class="p">:</span><span class="s1">&#39;--co=</span><span class="se">\&quot;</span><span class="s1">COMPRESS=LZW</span><span class="se">\&quot;</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="s1">&#39;OUTPUT&#39;</span><span class="p">:</span><span class="n">salida</span><span class="p">}</span>
    <span class="n">pr</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;gdal:rastercalculator&quot;</span><span class="p">,</span><span class="n">dicc</span><span class="p">)</span></div>
<div class="viewcode-block" id="crea_capa_raster"><a class="viewcode-back" href="../apcsig.html#apcsig.crea_capa_raster">[documentos]</a><span class="k">def</span> <span class="nf">crea_capa_raster</span><span class="p">(</span><span class="n">ecuacion</span><span class="p">,</span><span class="n">rasters_input</span><span class="p">,</span><span class="n">salida</span><span class="p">):</span> 

    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Esta función crea una capa mediante la calculadora raster</span>
<span class="sd">    de GDAL, esta función esta limitada hasta 14 variables en la ecuación.</span>

<span class="sd">    :param ecuacion: ecuación expresada en formato gdal,</span>
<span class="sd">    :type ecuacion: str</span>
<span class="sd">    :param rasters_input: lista de los paths de los archivos rasters</span>
<span class="sd">    :type rasters_input: list</span>
<span class="sd">    :param salida: ruta con extensión tiff de la salida</span>
<span class="sd">    :type salida: str</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">path_A</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
    <span class="n">path_B</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
    <span class="n">path_C</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
    <span class="n">path_D</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
    <span class="n">path_E</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
    <span class="n">path_F</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
    <span class="n">path_G</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
    <span class="n">path_H</span><span class="o">=</span><span class="s1">&#39;&#39;</span>  
    <span class="n">path_I</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
    <span class="n">path_J</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
    <span class="n">path_K</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
    <span class="n">path_L</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
    <span class="n">path_M</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
    <span class="n">path_N</span><span class="o">=</span><span class="s1">&#39;&#39;</span>


    <span class="n">total_raster</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">rasters_input</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">total_raster</span><span class="p">),</span> <span class="n">rasters_input</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">path_A</span><span class="o">=</span><span class="n">b</span>
        <span class="k">elif</span> <span class="n">a</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">path_B</span><span class="o">=</span><span class="n">b</span>
        <span class="k">elif</span> <span class="n">a</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">path_C</span><span class="o">=</span><span class="n">b</span>
        <span class="k">elif</span> <span class="n">a</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">path_D</span><span class="o">=</span><span class="n">b</span>
        <span class="k">elif</span> <span class="n">a</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">path_E</span><span class="o">=</span><span class="n">b</span>
        <span class="k">elif</span> <span class="n">a</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
            <span class="n">path_F</span><span class="o">=</span><span class="n">b</span>
        <span class="k">elif</span> <span class="n">a</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
            <span class="n">path_G</span><span class="o">=</span><span class="n">b</span>
        <span class="k">elif</span> <span class="n">a</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
            <span class="n">path_H</span><span class="o">=</span><span class="n">b</span>
        <span class="k">elif</span> <span class="n">a</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
            <span class="n">path_I</span><span class="o">=</span><span class="n">b</span>
        <span class="k">elif</span> <span class="n">a</span> <span class="o">==</span> <span class="mi">9</span><span class="p">:</span>
            <span class="n">path_J</span><span class="o">=</span><span class="n">b</span>
        <span class="k">elif</span> <span class="n">a</span> <span class="o">==</span> <span class="mi">10</span><span class="p">:</span>
            <span class="n">path_K</span><span class="o">=</span><span class="n">b</span>
        <span class="k">elif</span> <span class="n">a</span> <span class="o">==</span> <span class="mi">11</span><span class="p">:</span>
            <span class="n">path_L</span><span class="o">=</span><span class="n">b</span>
        <span class="k">elif</span> <span class="n">a</span> <span class="o">==</span> <span class="mi">12</span><span class="p">:</span>
            <span class="n">path_M</span><span class="o">=</span><span class="n">b</span>
        <span class="k">elif</span> <span class="n">a</span> <span class="o">==</span> <span class="mi">13</span><span class="p">:</span>
            <span class="n">path_N</span><span class="o">=</span><span class="n">b</span>

    <span class="n">tp_salida</span> <span class="o">=</span> <span class="n">salida</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_raw.tif&#39;</span>

   
     
    <span class="k">if</span> <span class="n">total_raster</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">gdal_calc</span><span class="o">.</span><span class="n">Calc</span><span class="p">(</span><span class="n">calc</span><span class="o">=</span><span class="n">ecuacion</span><span class="p">,</span> 
                        <span class="n">A</span><span class="o">=</span><span class="n">path_A</span><span class="p">,</span> 
                        <span class="n">outfile</span><span class="o">=</span><span class="n">tp_salida</span><span class="p">,</span>
                        <span class="n">NoDataValue</span><span class="o">=-</span><span class="mf">9999.0</span><span class="p">,</span>
                        <span class="n">creation_options</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;COMPRESS=LZW&quot;</span><span class="p">,</span><span class="s2">&quot;PREDICTOR=3&quot;</span><span class="p">,</span><span class="s2">&quot;TILED=YES&quot;</span><span class="p">],</span>
                        <span class="n">quiet</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                        
    <span class="k">if</span> <span class="n">total_raster</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">gdal_calc</span><span class="o">.</span><span class="n">Calc</span><span class="p">(</span><span class="n">calc</span><span class="o">=</span><span class="n">ecuacion</span><span class="p">,</span> 
                        <span class="n">A</span><span class="o">=</span><span class="n">path_A</span><span class="p">,</span> 
                        <span class="n">B</span><span class="o">=</span><span class="n">path_B</span><span class="p">,</span>
                        <span class="n">outfile</span><span class="o">=</span><span class="n">tp_salida</span><span class="p">,</span>
                        <span class="n">NoDataValue</span><span class="o">=-</span><span class="mf">9999.0</span><span class="p">,</span>
                        <span class="n">creation_options</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;COMPRESS=LZW&quot;</span><span class="p">,</span><span class="s2">&quot;PREDICTOR=3&quot;</span><span class="p">,</span><span class="s2">&quot;TILED=YES&quot;</span><span class="p">],</span>
                        <span class="n">quiet</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">total_raster</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">gdal_calc</span><span class="o">.</span><span class="n">Calc</span><span class="p">(</span><span class="n">calc</span><span class="o">=</span><span class="n">ecuacion</span><span class="p">,</span> 
                        <span class="n">A</span><span class="o">=</span><span class="n">path_A</span><span class="p">,</span> 
                        <span class="n">B</span><span class="o">=</span><span class="n">path_B</span><span class="p">,</span>
                        <span class="n">C</span><span class="o">=</span><span class="n">path_C</span><span class="p">,</span> 
                        <span class="n">outfile</span><span class="o">=</span><span class="n">tp_salida</span><span class="p">,</span>
                        <span class="n">NoDataValue</span><span class="o">=-</span><span class="mf">9999.0</span><span class="p">,</span>
                        <span class="n">creation_options</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;COMPRESS=LZW&quot;</span><span class="p">,</span><span class="s2">&quot;PREDICTOR=3&quot;</span><span class="p">,</span><span class="s2">&quot;TILED=YES&quot;</span><span class="p">],</span>
                        <span class="n">quiet</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                        
    <span class="k">if</span> <span class="n">total_raster</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
        <span class="n">gdal_calc</span><span class="o">.</span><span class="n">Calc</span><span class="p">(</span><span class="n">calc</span><span class="o">=</span><span class="n">ecuacion</span><span class="p">,</span> 
                        <span class="n">A</span><span class="o">=</span><span class="n">path_A</span><span class="p">,</span> 
                        <span class="n">B</span><span class="o">=</span><span class="n">path_B</span><span class="p">,</span>
                        <span class="n">C</span><span class="o">=</span><span class="n">path_C</span><span class="p">,</span> 
                        <span class="n">D</span><span class="o">=</span><span class="n">path_D</span><span class="p">,</span>
                        <span class="n">outfile</span><span class="o">=</span><span class="n">tp_salida</span><span class="p">,</span>
                        <span class="n">NoDataValue</span><span class="o">=-</span><span class="mf">9999.0</span><span class="p">,</span>
                        <span class="n">creation_options</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;COMPRESS=LZW&quot;</span><span class="p">,</span><span class="s2">&quot;PREDICTOR=3&quot;</span><span class="p">,</span><span class="s2">&quot;TILED=YES&quot;</span><span class="p">],</span>
                        <span class="n">quiet</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">total_raster</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
        <span class="n">gdal_calc</span><span class="o">.</span><span class="n">Calc</span><span class="p">(</span><span class="n">calc</span><span class="o">=</span><span class="n">ecuacion</span><span class="p">,</span> 
                        <span class="n">A</span><span class="o">=</span><span class="n">path_A</span><span class="p">,</span> 
                        <span class="n">B</span><span class="o">=</span><span class="n">path_B</span><span class="p">,</span>
                        <span class="n">C</span><span class="o">=</span><span class="n">path_C</span><span class="p">,</span> 
                        <span class="n">D</span><span class="o">=</span><span class="n">path_D</span><span class="p">,</span>
                        <span class="n">E</span><span class="o">=</span><span class="n">path_E</span><span class="p">,</span> 
                        <span class="n">outfile</span><span class="o">=</span><span class="n">tp_salida</span><span class="p">,</span>
                        <span class="n">NoDataValue</span><span class="o">=-</span><span class="mf">9999.0</span><span class="p">,</span>
                        <span class="n">creation_options</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;COMPRESS=LZW&quot;</span><span class="p">,</span><span class="s2">&quot;PREDICTOR=3&quot;</span><span class="p">,</span><span class="s2">&quot;TILED=YES&quot;</span><span class="p">],</span>
                        <span class="n">quiet</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                        
    <span class="k">if</span> <span class="n">total_raster</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
        <span class="n">gdal_calc</span><span class="o">.</span><span class="n">Calc</span><span class="p">(</span><span class="n">calc</span><span class="o">=</span><span class="n">ecuacion</span><span class="p">,</span> 
                        <span class="n">A</span><span class="o">=</span><span class="n">path_A</span><span class="p">,</span> 
                        <span class="n">B</span><span class="o">=</span><span class="n">path_B</span><span class="p">,</span>
                        <span class="n">C</span><span class="o">=</span><span class="n">path_C</span><span class="p">,</span> 
                        <span class="n">D</span><span class="o">=</span><span class="n">path_D</span><span class="p">,</span>
                        <span class="n">E</span><span class="o">=</span><span class="n">path_E</span><span class="p">,</span> 
                        <span class="n">F</span><span class="o">=</span><span class="n">path_F</span><span class="p">,</span>
                        <span class="n">outfile</span><span class="o">=</span><span class="n">tp_salida</span><span class="p">,</span>
                        <span class="n">NoDataValue</span><span class="o">=-</span><span class="mf">9999.0</span><span class="p">,</span>
                        <span class="n">creation_options</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;COMPRESS=LZW&quot;</span><span class="p">,</span><span class="s2">&quot;PREDICTOR=3&quot;</span><span class="p">,</span><span class="s2">&quot;TILED=YES&quot;</span><span class="p">],</span>
                        <span class="n">quiet</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">total_raster</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
        <span class="n">gdal_calc</span><span class="o">.</span><span class="n">Calc</span><span class="p">(</span><span class="n">calc</span><span class="o">=</span><span class="n">ecuacion</span><span class="p">,</span> 
                        <span class="n">A</span><span class="o">=</span><span class="n">path_A</span><span class="p">,</span> 
                        <span class="n">B</span><span class="o">=</span><span class="n">path_B</span><span class="p">,</span>
                        <span class="n">C</span><span class="o">=</span><span class="n">path_C</span><span class="p">,</span> 
                        <span class="n">D</span><span class="o">=</span><span class="n">path_D</span><span class="p">,</span>
                        <span class="n">E</span><span class="o">=</span><span class="n">path_E</span><span class="p">,</span> 
                        <span class="n">F</span><span class="o">=</span><span class="n">path_F</span><span class="p">,</span>
                        <span class="n">G</span><span class="o">=</span><span class="n">path_G</span><span class="p">,</span> 
                        <span class="n">outfile</span><span class="o">=</span><span class="n">tp_salida</span><span class="p">,</span>
                        <span class="n">NoDataValue</span><span class="o">=-</span><span class="mf">9999.0</span><span class="p">,</span>
                        <span class="n">creation_options</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;COMPRESS=LZW&quot;</span><span class="p">,</span><span class="s2">&quot;PREDICTOR=3&quot;</span><span class="p">,</span><span class="s2">&quot;TILED=YES&quot;</span><span class="p">],</span>
                        <span class="n">quiet</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                            
    <span class="k">if</span> <span class="n">total_raster</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
        <span class="n">gdal_calc</span><span class="o">.</span><span class="n">Calc</span><span class="p">(</span><span class="n">calc</span><span class="o">=</span><span class="n">ecuacion</span><span class="p">,</span> 
                        <span class="n">A</span><span class="o">=</span><span class="n">path_A</span><span class="p">,</span> 
                        <span class="n">B</span><span class="o">=</span><span class="n">path_B</span><span class="p">,</span>
                        <span class="n">C</span><span class="o">=</span><span class="n">path_C</span><span class="p">,</span> 
                        <span class="n">D</span><span class="o">=</span><span class="n">path_D</span><span class="p">,</span>
                        <span class="n">E</span><span class="o">=</span><span class="n">path_E</span><span class="p">,</span> 
                        <span class="n">F</span><span class="o">=</span><span class="n">path_F</span><span class="p">,</span>
                        <span class="n">G</span><span class="o">=</span><span class="n">path_G</span><span class="p">,</span> 
                        <span class="n">H</span><span class="o">=</span><span class="n">path_H</span><span class="p">,</span>
                        <span class="n">outfile</span><span class="o">=</span><span class="n">tp_salida</span><span class="p">,</span>
                        <span class="n">NoDataValue</span><span class="o">=-</span><span class="mf">9999.0</span><span class="p">,</span>
                        <span class="n">creation_options</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;COMPRESS=LZW&quot;</span><span class="p">,</span><span class="s2">&quot;PREDICTOR=3&quot;</span><span class="p">,</span><span class="s2">&quot;TILED=YES&quot;</span><span class="p">],</span>
                        <span class="n">quiet</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        
    <span class="k">if</span> <span class="n">total_raster</span> <span class="o">==</span> <span class="mi">9</span><span class="p">:</span>
        <span class="n">gdal_calc</span><span class="o">.</span><span class="n">Calc</span><span class="p">(</span><span class="n">calc</span><span class="o">=</span><span class="n">ecuacion</span><span class="p">,</span> 
                        <span class="n">A</span><span class="o">=</span><span class="n">path_A</span><span class="p">,</span> 
                        <span class="n">B</span><span class="o">=</span><span class="n">path_B</span><span class="p">,</span>
                        <span class="n">C</span><span class="o">=</span><span class="n">path_C</span><span class="p">,</span> 
                        <span class="n">D</span><span class="o">=</span><span class="n">path_D</span><span class="p">,</span>
                        <span class="n">E</span><span class="o">=</span><span class="n">path_E</span><span class="p">,</span> 
                        <span class="n">F</span><span class="o">=</span><span class="n">path_F</span><span class="p">,</span>
                        <span class="n">G</span><span class="o">=</span><span class="n">path_G</span><span class="p">,</span> 
                        <span class="n">H</span><span class="o">=</span><span class="n">path_H</span><span class="p">,</span>
                        <span class="n">I</span><span class="o">=</span><span class="n">path_I</span><span class="p">,</span>
                        <span class="n">outfile</span><span class="o">=</span><span class="n">tp_salida</span><span class="p">,</span>
                        <span class="n">NoDataValue</span><span class="o">=-</span><span class="mf">9999.0</span><span class="p">,</span>
                        <span class="n">creation_options</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;COMPRESS=LZW&quot;</span><span class="p">,</span><span class="s2">&quot;PREDICTOR=3&quot;</span><span class="p">,</span><span class="s2">&quot;TILED=YES&quot;</span><span class="p">],</span>
                        <span class="n">quiet</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">total_raster</span> <span class="o">==</span> <span class="mi">10</span><span class="p">:</span>
        <span class="n">gdal_calc</span><span class="o">.</span><span class="n">Calc</span><span class="p">(</span><span class="n">calc</span><span class="o">=</span><span class="n">ecuacion</span><span class="p">,</span> 
                        <span class="n">A</span><span class="o">=</span><span class="n">path_A</span><span class="p">,</span> 
                        <span class="n">B</span><span class="o">=</span><span class="n">path_B</span><span class="p">,</span>
                        <span class="n">C</span><span class="o">=</span><span class="n">path_C</span><span class="p">,</span> 
                        <span class="n">D</span><span class="o">=</span><span class="n">path_D</span><span class="p">,</span>
                        <span class="n">E</span><span class="o">=</span><span class="n">path_E</span><span class="p">,</span> 
                        <span class="n">F</span><span class="o">=</span><span class="n">path_F</span><span class="p">,</span>
                        <span class="n">G</span><span class="o">=</span><span class="n">path_G</span><span class="p">,</span> 
                        <span class="n">H</span><span class="o">=</span><span class="n">path_H</span><span class="p">,</span>
                        <span class="n">I</span><span class="o">=</span><span class="n">path_I</span><span class="p">,</span>
                        <span class="n">J</span><span class="o">=</span><span class="n">path_J</span><span class="p">,</span>
                        <span class="n">outfile</span><span class="o">=</span><span class="n">tp_salida</span><span class="p">,</span>
                        <span class="n">NoDataValue</span><span class="o">=-</span><span class="mf">9999.0</span><span class="p">,</span>
                        <span class="n">creation_options</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;COMPRESS=LZW&quot;</span><span class="p">,</span><span class="s2">&quot;PREDICTOR=3&quot;</span><span class="p">,</span><span class="s2">&quot;TILED=YES&quot;</span><span class="p">],</span>
                        <span class="n">quiet</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">total_raster</span> <span class="o">==</span> <span class="mi">11</span><span class="p">:</span>
        <span class="n">gdal_calc</span><span class="o">.</span><span class="n">Calc</span><span class="p">(</span><span class="n">calc</span><span class="o">=</span><span class="n">ecuacion</span><span class="p">,</span> 
                        <span class="n">A</span><span class="o">=</span><span class="n">path_A</span><span class="p">,</span> 
                        <span class="n">B</span><span class="o">=</span><span class="n">path_B</span><span class="p">,</span>
                        <span class="n">C</span><span class="o">=</span><span class="n">path_C</span><span class="p">,</span> 
                        <span class="n">D</span><span class="o">=</span><span class="n">path_D</span><span class="p">,</span>
                        <span class="n">E</span><span class="o">=</span><span class="n">path_E</span><span class="p">,</span> 
                        <span class="n">F</span><span class="o">=</span><span class="n">path_F</span><span class="p">,</span>
                        <span class="n">G</span><span class="o">=</span><span class="n">path_G</span><span class="p">,</span> 
                        <span class="n">H</span><span class="o">=</span><span class="n">path_H</span><span class="p">,</span>
                        <span class="n">I</span><span class="o">=</span><span class="n">path_I</span><span class="p">,</span>
                        <span class="n">J</span><span class="o">=</span><span class="n">path_J</span><span class="p">,</span>
                        <span class="n">K</span><span class="o">=</span><span class="n">path_K</span><span class="p">,</span>
                        <span class="n">outfile</span><span class="o">=</span><span class="n">tp_salida</span><span class="p">,</span>
                        <span class="n">NoDataValue</span><span class="o">=-</span><span class="mf">9999.0</span><span class="p">,</span>
                        <span class="n">creation_options</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;COMPRESS=LZW&quot;</span><span class="p">,</span><span class="s2">&quot;PREDICTOR=3&quot;</span><span class="p">,</span><span class="s2">&quot;TILED=YES&quot;</span><span class="p">],</span>
                        <span class="n">quiet</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">total_raster</span> <span class="o">==</span> <span class="mi">12</span><span class="p">:</span>
        <span class="n">gdal_calc</span><span class="o">.</span><span class="n">Calc</span><span class="p">(</span><span class="n">calc</span><span class="o">=</span><span class="n">ecuacion</span><span class="p">,</span> 
                        <span class="n">A</span><span class="o">=</span><span class="n">path_A</span><span class="p">,</span> 
                        <span class="n">B</span><span class="o">=</span><span class="n">path_B</span><span class="p">,</span>
                        <span class="n">C</span><span class="o">=</span><span class="n">path_C</span><span class="p">,</span> 
                        <span class="n">D</span><span class="o">=</span><span class="n">path_D</span><span class="p">,</span>
                        <span class="n">E</span><span class="o">=</span><span class="n">path_E</span><span class="p">,</span> 
                        <span class="n">F</span><span class="o">=</span><span class="n">path_F</span><span class="p">,</span>
                        <span class="n">G</span><span class="o">=</span><span class="n">path_G</span><span class="p">,</span> 
                        <span class="n">H</span><span class="o">=</span><span class="n">path_H</span><span class="p">,</span>
                        <span class="n">I</span><span class="o">=</span><span class="n">path_I</span><span class="p">,</span>
                        <span class="n">J</span><span class="o">=</span><span class="n">path_J</span><span class="p">,</span>
                        <span class="n">K</span><span class="o">=</span><span class="n">path_K</span><span class="p">,</span>
                        <span class="n">L</span><span class="o">=</span><span class="n">path_L</span><span class="p">,</span>
                        <span class="n">outfile</span><span class="o">=</span><span class="n">tp_salida</span><span class="p">,</span>
                        <span class="n">NoDataValue</span><span class="o">=-</span><span class="mf">9999.0</span><span class="p">,</span>
                        <span class="n">creation_options</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;COMPRESS=LZW&quot;</span><span class="p">,</span><span class="s2">&quot;PREDICTOR=3&quot;</span><span class="p">,</span><span class="s2">&quot;TILED=YES&quot;</span><span class="p">],</span>
                        <span class="n">quiet</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">total_raster</span> <span class="o">==</span> <span class="mi">13</span><span class="p">:</span>
        <span class="n">gdal_calc</span><span class="o">.</span><span class="n">Calc</span><span class="p">(</span><span class="n">calc</span><span class="o">=</span><span class="n">ecuacion</span><span class="p">,</span> 
                        <span class="n">A</span><span class="o">=</span><span class="n">path_A</span><span class="p">,</span> 
                        <span class="n">B</span><span class="o">=</span><span class="n">path_B</span><span class="p">,</span>
                        <span class="n">C</span><span class="o">=</span><span class="n">path_C</span><span class="p">,</span> 
                        <span class="n">D</span><span class="o">=</span><span class="n">path_D</span><span class="p">,</span>
                        <span class="n">E</span><span class="o">=</span><span class="n">path_E</span><span class="p">,</span> 
                        <span class="n">F</span><span class="o">=</span><span class="n">path_F</span><span class="p">,</span>
                        <span class="n">G</span><span class="o">=</span><span class="n">path_G</span><span class="p">,</span> 
                        <span class="n">H</span><span class="o">=</span><span class="n">path_H</span><span class="p">,</span>
                        <span class="n">I</span><span class="o">=</span><span class="n">path_I</span><span class="p">,</span>
                        <span class="n">J</span><span class="o">=</span><span class="n">path_J</span><span class="p">,</span>
                        <span class="n">K</span><span class="o">=</span><span class="n">path_K</span><span class="p">,</span>
                        <span class="n">L</span><span class="o">=</span><span class="n">path_L</span><span class="p">,</span>
                        <span class="n">M</span><span class="o">=</span><span class="n">path_M</span><span class="p">,</span>
                        <span class="n">outfile</span><span class="o">=</span><span class="n">tp_salida</span><span class="p">,</span>
                        <span class="n">NoDataValue</span><span class="o">=-</span><span class="mf">9999.0</span><span class="p">,</span>
                        <span class="n">creation_options</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;COMPRESS=LZW&quot;</span><span class="p">,</span><span class="s2">&quot;PREDICTOR=3&quot;</span><span class="p">,</span><span class="s2">&quot;TILED=YES&quot;</span><span class="p">],</span>
                        <span class="n">quiet</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">total_raster</span> <span class="o">==</span> <span class="mi">14</span><span class="p">:</span>
        <span class="n">gdal_calc</span><span class="o">.</span><span class="n">Calc</span><span class="p">(</span><span class="n">calc</span><span class="o">=</span><span class="n">ecuacion</span><span class="p">,</span> 
                        <span class="n">A</span><span class="o">=</span><span class="n">path_A</span><span class="p">,</span> 
                        <span class="n">B</span><span class="o">=</span><span class="n">path_B</span><span class="p">,</span>
                        <span class="n">C</span><span class="o">=</span><span class="n">path_C</span><span class="p">,</span> 
                        <span class="n">D</span><span class="o">=</span><span class="n">path_D</span><span class="p">,</span>
                        <span class="n">E</span><span class="o">=</span><span class="n">path_E</span><span class="p">,</span> 
                        <span class="n">F</span><span class="o">=</span><span class="n">path_F</span><span class="p">,</span>
                        <span class="n">G</span><span class="o">=</span><span class="n">path_G</span><span class="p">,</span> 
                        <span class="n">H</span><span class="o">=</span><span class="n">path_H</span><span class="p">,</span>
                        <span class="n">I</span><span class="o">=</span><span class="n">path_I</span><span class="p">,</span>
                        <span class="n">J</span><span class="o">=</span><span class="n">path_J</span><span class="p">,</span>
                        <span class="n">K</span><span class="o">=</span><span class="n">path_K</span><span class="p">,</span>
                        <span class="n">L</span><span class="o">=</span><span class="n">path_L</span><span class="p">,</span>
                        <span class="n">M</span><span class="o">=</span><span class="n">path_M</span><span class="p">,</span>
                        <span class="n">N</span><span class="o">=</span><span class="n">path_N</span><span class="p">,</span>
                        <span class="n">outfile</span><span class="o">=</span><span class="n">tp_salida</span><span class="p">,</span>
                        <span class="n">NoDataValue</span><span class="o">=-</span><span class="mf">9999.0</span><span class="p">,</span>
                        <span class="n">creation_options</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;COMPRESS=LZW&quot;</span><span class="p">,</span><span class="s2">&quot;PREDICTOR=3&quot;</span><span class="p">,</span><span class="s2">&quot;TILED=YES&quot;</span><span class="p">],</span>
                        <span class="n">quiet</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">redondea_raster</span><span class="p">(</span><span class="n">tp_salida</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">salida</span><span class="p">)</span>
    <span class="n">remove_raster</span><span class="p">(</span><span class="n">tp_salida</span><span class="p">)</span></div>
<div class="viewcode-block" id="remove_raster"><a class="viewcode-back" href="../apcsig.html#apcsig.remove_raster">[documentos]</a><span class="k">def</span> <span class="nf">remove_raster</span><span class="p">(</span><span class="n">path_r</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Esta función elimina una capa del sistema</span>

<span class="sd">    :param path_r: ruta de la capa </span>
<span class="sd">    :type path_r: str</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">path_r</span><span class="p">)</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Víctor Hernández

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>